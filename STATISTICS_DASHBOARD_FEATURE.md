# 统计仪表板功能文档

## 功能概述

统计仪表板为体重跟踪应用提供了全面的数据分析和可视化功能，帮助用户更好地了解自己的体重变化趋势和健康状况。

## 主要功能

### 1. 统计指标计算
- **当前体重**: 最新的体重记录
- **目标体重**: 用户设定的目标体重
- **已减重量**: 目标体重与当前体重的差值
- **平均体重**: 所有记录的平均值
- **BMI 计算**: 基于身高和当前体重计算BMI指数
- **最高体重**: 历史记录中的最高体重
- **最低体重**: 历史记录中的最低体重
- **最近7天/30天变化趋势**: 分析短期体重变化

### 2. 仪表板页面布局
- **卡片式设计**: 每个统计项使用独立的卡片展示
- **主要指标卡片**: 显示当前体重、目标体重、平均体重
- **BMI卡片**: 显示BMI值、状态分类和参考标准
- **趋势卡片**: 显示7天和30天趋势、最高/最低体重
- **进度卡片**: 显示减重进度条和完成百分比
- **历史记录卡片**: 显示总记录数和快速访问链接

### 3. 交互功能
- **下拉刷新**: 手动刷新统计数据
- **点击卡片**: 查看详细信息
- **时间范围选择**: 支持全部、本月、本周、7天、30天等时间范围
- **身高设置**: 点击身高可弹出设置对话框
- **导航集成**: 与其他页面无缝集成

### 4. 数据来源
- **WeightRecordDao**: 查询历史体重记录
- **WeightRecord**: 获取目标体重信息
- **StatisticsService**: 统计数据计算和缓存服务

## 技术实现

### 核心组件

#### 1. WeightStatistics.ets
```typescript
export class WeightStatistics {
  currentWeight: number;
  targetWeight: number;
  weightLoss: number;
  averageWeight: number;
  bmi: number;
  maxWeight: number;
  minWeight: number;
  totalRecords: number;
  trend7Days: TrendData;
  trend30Days: TrendData;
  progressPercentage: number;
  lastUpdated: number;
}
```

#### 2. StatisticsService.ets
- 数据缓存机制（5分钟缓存）
- 身高信息管理
- 时间范围统计
- 性能优化

#### 3. StatisticsDashboard.ets
- 主仪表板页面
- 卡片式UI布局
- 交互功能实现

#### 4. HeightSettingDialog.ets
- 身高设置对话框
- 输入验证
- 数据持久化

#### 5. TimeRangeSelector.ets
- 时间范围选择器
- 动态筛选功能

### 数据流程

1. **数据获取**: 从WeightRecordDao查询历史记录
2. **统计计算**: 使用StatisticsCalculator计算各项指标
3. **数据缓存**: 缓存计算结果，提高性能
4. **UI渲染**: 响应式更新界面
5. **用户交互**: 处理用户操作和状态变化

## 页面导航

### 访问路径
1. 主页(Index) → "统计仪表板"按钮 → StatisticsDashboard页面
2. 统计仪表板 → "查看详情"按钮 → History页面
3. 统计仪表板 → 返回按钮 → 返回主页

### 路由配置
```json
{
  "src": [
    "pages/Index",
    "pages/History",
    "pages/WeightEntryForm",
    "pages/RecordDetail",
    "pages/WeightEditForm",
    "pages/WeightChart",
    "pages/StatisticsDashboard"
  ]
}
```

## 性能优化

### 1. 缓存策略
- 统计数据缓存5分钟
- 身高信息持久化存储
- 避免重复计算

### 2. 查询优化
- 使用现有的DAO方法
- 时间范围查询优化
- 大数据量处理

### 3. UI优化
- 懒加载卡片内容
- 响应式设计
- 流畅的动画效果

## 验收标准

### ✅ 功能完整性
- [x] 所有统计数据计算正确
- [x] 支持时间范围筛选
- [x] 身高设置功能
- [x] 下拉刷新功能
- [x] 页面导航集成

### ✅ UI/UX设计
- [x] 卡片式设计符合HarmonyOS规范
- [x] 响应式布局
- [x] 颜色状态指示
- [x] 流畅的交互动画

### ✅ 性能要求
- [x] 数据缓存机制
- [x] 查询性能优化
- [x] 页面加载流畅

### ✅ 代码质量
- [x] 遵循项目规范
- [x] 模块化设计
- [x] 错误处理
- [x] 类型安全

## 使用示例

### 基本使用
1. 用户点击主页的"统计仪表板"按钮
2. 系统加载并显示各项统计数据
3. 用户可以查看不同时间范围的数据
4. 点击身高可以设置个人身高信息
5. 下拉刷新可以更新最新数据

### 高级功能
- 时间范围选择：查看特定时期的统计
- 身高设置：个性化BMI计算
- 进度跟踪：查看减重进度
- 趋势分析：了解体重变化模式

## 扩展性

### 未来可扩展功能
- 目标体重动态调整
- 更多的健康指标（体脂率、肌肉量等）
- 数据导出功能
- 统计报告生成
- 社交分享功能

### 技术扩展点
- 数据可视化图表
- 机器学习预测
- 云端数据同步
- 多设备支持

## 维护说明

### 常见问题
1. **数据不准确**: 检查缓存是否过期，手动刷新
2. **BMI计算错误**: 确认身高设置是否正确
3. **性能问题**: 检查数据量是否过大，考虑分页

### 更新日志
- v1.0.0: 初始版本，基础统计功能
- 支持时间范围筛选
- 添加身高设置功能
- 优化缓存机制
