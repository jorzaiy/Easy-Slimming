# 鸿蒙运动健康同步功能使用指南

## 快速开始

### 功能入口
1. 打开应用，在主页（Index）找到"鸿蒙同步"按钮
2. 点击进入同步主页面

### 首次设置
1. 点击"同步设置"按钮
2. 启用"启用同步"开关
3. 选择同步模式：
   - **手动同步**: 需要手动点击按钮进行同步
   - **自动同步**: 应用定期自动同步
   - **后台同步**: 后台定期自动同步（推荐）
4. 设置其他选项后点击"保存"

### 开始同步
1. 回到同步主页面
2. 点击"同步到鸿蒙"按钮开始同步
3. 查看同步进度和结果

## 同步模式详解

### 手动同步 (MANUAL)
- **场景**: 用户希望完全控制同步时机
- **操作**: 每次需要点击"同步到鸿蒙"按钮
- **优点**: 省流量，完全用户控制
- **缺点**: 需要手动操作

### 自动同步 (AUTO)
- **场景**: 希望定期同步但应用在前台时
- **操作**: 应用自动定期同步
- **优点**: 无需手动操作
- **缺点**: 应用必须运行

### 后台同步 (AUTO_BACKGROUND)
- **场景**: 希望完全自动同步
- **操作**: 即使应用关闭也继续同步
- **优点**: 最自动化，用户无需关注
- **缺点**: 耗电量较大

## 冲突处理

### 什么时候会产生冲突？
当本地数据和鸿蒙健康应用中的数据不一致时：
- 同一天的体重数据不同
- 时间戳冲突
- 数据版本不匹配

### 冲突解决策略

#### 1. 保留本地数据 (LOCAL)
```
本地: 65.0kg
鸿蒙: 65.5kg
结果: 保留 65.0kg
```
**适用场景**: 你更相信本地应用的数据

#### 2. 使用鸿蒙数据 (HEALTH)
```
本地: 65.0kg
鸿蒙: 65.5kg
结果: 使用 65.5kg
```
**适用场景**: 你更相信鸿蒙健康应用的数据

#### 3. 合并数据 (MERGE_AVERAGE)
```
本地: 65.0kg
鸿蒙: 65.5kg
结果: 使用平均值 65.25kg
```
**适用场景**: 两个数据源都相对可靠

#### 4. 跳过 (SKIP)
```
本地: 65.0kg
鸿蒙: 65.5kg
结果: 保留原本地数据，不做任何更改
```
**适用场景**: 暂时不处理冲突

## 同步历史查看

在同步主页面，可以看到所有历史同步记录：
- **同步方向**: → 鸿蒙 (发送) 或 ← 鸿蒙 (接收)
- **同步时间**: 同步开始的时间
- **同步状态**: 成功/失败/进行中
- **耗时**: 同步花费的时间
- **错误信息**: 同步失败时的错误描述

## 高级设置

### 同步频率
- **范围**: 5分钟 ~ 240分钟
- **默认**: 60分钟
- **影响**: 自动同步模式下的同步间隔

### 最大重试次数
- **范围**: 0 ~ 10
- **默认**: 3
- **说明**: 同步失败时的重试次数

### 请求超时时间
- **默认**: 30秒
- **说明**: API请求的超时限制

### 应用启动时同步
- **启用**: 应用启动时自动同步一次
- **禁用**: 应用启动时不同步
- **建议**: 启用此选项以保持数据最新

## 错误处理

### 常见错误

#### 1. 权限不足
```
错误: "权限被拒绝"
解决:
1. 打开系统设置
2. 找到应用权限
3. 允许"健康数据读写权限"
4. 重新尝试同步
```

#### 2. 网络连接失败
```
错误: "网络连接失败"
解决:
1. 检查网络连接
2. 确保WiFi或流量已启用
3. 重新尝试同步
系统会自动重试 (默认3次)
```

#### 3. 鸿蒙健康应用未安装
```
错误: "鸿蒙健康应用未响应"
解决:
1. 确保已安装鸿蒙运动健康应用
2. 启动鸿蒙运动健康应用
3. 重新尝试同步
```

#### 4. 数据格式错误
```
错误: "数据格式不兼容"
解决:
1. 检查本地数据是否完整
2. 删除异常数据
3. 重新尝试同步
```

### 启用详细日志
在设置中启用"详细日志"选项，以便调试问题：
- 更详细的错误信息
- 同步过程中的每一步操作记录
- 性能指标

## 数据同步示例

### 示例1: 首次同步
```
操作流程:
1. 手机本地有10条体重记录
2. 鸿蒙健康应用中没有数据
3. 点击"同步到鸿蒙"
4. 系统将10条记录发送到鸿蒙

结果:
- 成功数: 10
- 失败数: 0
- 冲突数: 0
- 消息: "同步完成: 10条成功, 0条失败"
```

### 示例2: 处理冲突
```
操作流程:
1. 本地数据: 2024-01-01 65.0kg
2. 鸿蒙数据: 2024-01-01 65.5kg
3. 设置冲突策略为"合并"
4. 点击"同步到鸿蒙"

结果:
- 检测到1个冲突
- 使用合并策略
- 新数据: 2024-01-01 65.25kg
```

### 示例3: 自动同步成功
```
配置:
- 同步模式: 自动同步
- 同步频率: 每60分钟
- 冲突策略: 保留本地

过程:
08:00 - 应用启动，自动同步一次
09:00 - 自动同步
10:00 - 自动同步
11:00 - 自动同步

用户无需做任何操作，数据自动保持同步
```

## 性能建议

### 流量节省
- 使用"手动同步"模式，需要时再同步
- 降低自动同步频率（增加间隔时间）
- 仅在WiFi连接时进行同步

### 电池节省
- 禁用"后台同步"模式
- 增加同步间隔
- 禁用"应用启动时同步"

### 数据安全
- 启用冲突检测
- 定期检查同步历史
- 在执行危险操作前备份数据

## 常见问题 (FAQ)

### Q1: 同步会删除我的数据吗?
**A**: 不会。同步只是在本地和鸿蒙之间复制数据。原数据保持不变。

### Q2: 如何取消正在进行的同步?
**A**: 当前不支持取消。等待同步完成或关闭应用。

### Q3: 能否手动编辑同步历史?
**A**: 不能。同步历史是只读的，用于查看过去的操作。

### Q4: 如果同步失败怎么办?
**A**: 
1. 检查网络连接
2. 检查权限设置
3. 查看错误信息
4. 系统会自动重试（默认3次）
5. 如果继续失败，可以清空缓存后重试

### Q5: 多久同步一次比较合适?
**A**: 
- 日常使用: 每小时一次
- 频繁输入: 每30分钟一次
- 轻度使用: 每天2-3次（手动）

## 联系支持

如遇到问题，请：
1. 查看同步历史中的错误信息
2. 检查应用日志
3. 确保所有权限已授予
4. 卸载并重新安装应用

---

**最后更新**: 2024年
**功能版本**: 1.0.0
